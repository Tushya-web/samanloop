{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Wallet | SamanLoop</title>

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        :root {
            --brand-teal: #20c997;
            --brand-teal-dark: #1ba87e;
            --navy-dark: #0a192f;
            --soft-blue: #f1f5f9;
            --text-main: #1e293b;
            --border-color: #e2e8f0;
            --bg-gradient: radial-gradient(circle at top right, #f0fffb 0%, #f8fafc 100%);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg-gradient);
            background-attachment: fixed;
            color: var(--text-main);
        }

        .navbar-custom {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-color);
            padding: 0.8rem 1.5rem;
        }

        /* ðŸ”¹ Wallet Card */
        .wallet-card {
            background: linear-gradient(135deg, var(--navy-dark) 0%, #1e293b 100%);
            color: white;
            border-radius: 30px;
            padding: 40px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(10, 25, 47, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .wallet-card::after {
            content: "";
            position: absolute;
            top: -30px;
            right: -30px;
            width: 140px;
            height: 140px;
            background: var(--brand-teal);
            filter: blur(60px);
            opacity: 0.2;
            border-radius: 50%;
        }

        /* ðŸ”¹ Stat Box Actions */
        .stat-box {
            background: white;
            border-radius: 24px;
            padding: 24px;
            border: 1px solid var(--border-color);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            color: var(--text-main);
            display: block;
            cursor: pointer;
        }

        .stat-box:hover {
            transform: translateY(-8px);
            border-color: var(--brand-teal);
            box-shadow: 0 15px 30px rgba(32, 201, 151, 0.1);
        }

        .icon-circle {
            width: 55px;
            height: 55px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
        }

        /* ðŸ”¹ Transactions */
        .tx-item {
            background: white;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            padding: 16px 20px;
            margin-bottom: 12px;
            transition: 0.2s;
        }

        /* ðŸ”¹ Payment Methods In Modal */
        .method-card {
            border: 2px solid #f1f5f9;
            border-radius: 18px;
            padding: 12px;
            cursor: pointer;
            transition: 0.2s;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 65px;
            overflow: hidden;
        }

        .method-card img {
            max-height: 22px;
            width: auto;
            filter: grayscale(100%);
            opacity: 0.6;
        }

        .method-card:hover, .method-card.active {
            border-color: var(--brand-teal);
            background: #f0fffb;
            box-shadow: 0 4px 12px rgba(32, 201, 151, 0.15);
        }

        .method-card:hover img, .method-card.active img {
            filter: grayscale(0%);
            opacity: 1;
        }

        .section-header {
            font-weight: 800;
            font-size: 0.8rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin: 40px 0 20px 5px;
        }

        .modal-content { border-radius: 32px; border: none; }

        /* ðŸ“± MOBILE MEDIA QUERIES */
        @media (max-width: 768px) {
            .navbar-custom { padding: 0.5rem 1rem; }
            
            .wallet-card { padding: 25px; border-radius: 24px; }
            .wallet-card h1.display-3 { font-size: 2.2rem; }
            
            .stat-box { padding: 18px; border-radius: 20px; }
            .stat-box h6 { font-size: 0.9rem; }
            .stat-box p { font-size: 0.75rem; }
            .icon-circle { width: 45px; height: 45px; margin-bottom: 10px; }
            .icon-circle i { font-size: 1.2rem !important; }

            .tx-item { padding: 12px 15px; border-radius: 16px; }
            .tx-item h6 { font-size: 0.85rem; }
            .tx-item .fs-5 { font-size: 1rem !important; }

            .method-card { height: 55px; padding: 8px; }
            .method-card img { max-height: 18px; }

            .modal-content { border-radius: 24px; }
            .btn-success, .btn-primary { padding: 12px !important; font-size: 0.95rem; }
        }
    </style>
</head>
<body>

<nav class="navbar navbar-custom sticky-top mb-4">
    <div class="container">
        <a class="btn btn-light btn-sm rounded-pill px-3 border shadow-sm" href="{% url 'account_hub' %}">
            <i class="bi bi-arrow-left me-1"></i> <span class="d-none d-md-inline">Hub</span>
        </a>
        <a class="navbar-brand fw-bold mx-auto" href="#">
            <img src="{% static 'images/Group 7.png' %}" alt="SamanLoop" height="32" class="mobile-logo">
        </a>
        <div style="width: 70px;"></div> 
    </div>
</nav>

<div class="container py-2" style="max-width: 900px;">
    
    <div class="wallet-card shadow mb-4">
        <div class="row align-items-center">
            <div class="col-md-7 text-center text-md-start">
                <p class="text-uppercase small fw-bold opacity-75 mb-1" style="letter-spacing: 2px;">Total Balance</p>
                <h1 class="display-3 fw-bold mb-0">â‚¹{{ wallet.balance|default:"1,250.00" }}</h1>
                <p class="small mt-2 text-success fw-bold d-none d-md-block"><i class="bi bi-shield-lock-fill"></i> Bank-grade encryption active</p>
            </div>
            <div class="col-md-5 mt-3 mt-md-0">
                <div class="d-flex flex-column gap-2">
                    <div class="p-2 px-3 rounded-4 bg-white bg-opacity-10 border border-white border-opacity-10 d-flex justify-content-between align-items-center">
                        <span class="small opacity-75">Held Deposits</span>
                        <span class="fw-bold text-warning small">â‚¹{{ wallet.held_deposit|default:"300" }}</span>
                    </div>
                    <div class="p-2 px-3 rounded-4 bg-white bg-opacity-10 border border-white border-opacity-10 d-flex justify-content-between align-items-center">
                        <span class="small opacity-75">Pending Clear</span>
                        <span class="fw-bold text-info small">â‚¹{{ wallet.pending_earnings|default:"450" }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-3">
        <div class="col-6">
            <div class="stat-box text-center shadow-sm" data-bs-toggle="modal" data-bs-target="#addMoneyModal">
                <div class="icon-circle bg-success bg-opacity-10">
                    <i class="bi bi-wallet2 text-success fs-3"></i>
                </div>
                <h6 class="fw-bold mb-1">Add Money</h6>
                <p class="small text-muted mb-0 d-none d-md-block">Top-up via UPI or Cards</p>
            </div>
        </div>
        <div class="col-6">
            <div class="stat-box text-center shadow-sm" data-bs-toggle="modal" data-bs-target="#withdrawModal">
                <div class="icon-circle bg-primary bg-opacity-10">
                    <i class="bi bi-bank text-primary fs-3"></i>
                </div>
                <h6 class="fw-bold mb-1">Withdraw</h6>
                <p class="small text-muted mb-0 d-none d-md-block">Transfer to Bank Account</p>
            </div>
        </div>
    </div>

    <div class="section-header">Activity History</div>

    <div class="transaction-list">
        {% for tx in transactions %}
        <div class="tx-item d-flex align-items-center shadow-sm">
            <div class="icon-circle {% if tx.transaction_type == 'credit' %}bg-success{% else %}bg-danger{% endif %} bg-opacity-10 m-0 me-3" style="width:40px; height:40px; border-radius: 12px;">
                <i class="bi {% if tx.transaction_type == 'credit' %}bi-arrow-down-left text-success{% else %}bi-arrow-up-right text-danger{% endif %}" style="font-size: 1rem !important;"></i>
            </div>
            <div class="flex-grow-1 overflow-hidden">
                <h6 class="fw-bold mb-0 text-dark text-truncate">{{ tx.description|default:"Security Deposit" }}</h6>
                <small class="text-muted" style="font-size: 0.7rem;">{{ tx.created_at|date:"d M, h:i A" }}</small>
            </div>
            <div class="text-end">
                <div class="fw-bold fs-5 {% if tx.transaction_type == 'credit' %}text-success{% else %}text-danger{% endif %}">
                    {% if tx.transaction_type == 'credit' %}+{% else %}-{% endif %}â‚¹{{ tx.amount }}
                </div>
                <span class="badge rounded-pill bg-light text-muted border-0" style="font-size: 0.6rem;">Success</span>
            </div>
        </div>
        {% empty %}
        <div class="text-center py-5 bg-white rounded-4 border border-dashed shadow-sm">
            <p class="text-muted mb-0 small">No transactions found.</p>
        </div>
        {% endfor %}
    </div>

</div>

<div class="modal fade" id="addMoneyModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content shadow-lg">
        <div class="modal-body p-4">
          <div class="d-flex justify-content-between align-items-center mb-4">
              <h5 class="fw-bold mb-0">Add Money</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>

          <form method="POST" action="{% url 'wallet_add_money' %}">
            {% csrf_token %}
            <div class="mb-4">
              <label class="form-label fw-bold small text-muted">ENTER AMOUNT</label>
              <div class="input-group input-group-lg border rounded-4 overflow-hidden">
                <span class="input-group-text bg-white border-0">â‚¹</span>
                <input type="number" name="amount" class="form-control border-0 ps-0 fw-bold" placeholder="500" required>
              </div>
            </div>

            <label class="form-label fw-bold small text-muted mb-3">SECURE CHECKOUT VIA</label>
            <div class="row g-2 mb-4">
                <div class="col-4">
                    <div class="method-card active">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/b/b2/Google_Pay_Logo.svg" alt="GPay" style="filter: none; opacity: 1;">
                    </div>
                </div>
                <div class="col-4">
                    <div class="method-card">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/2/24/Paytm_Logo_%28standalone%29.svg" alt="Paytm">
                    </div>
                </div>
                <div class="col-4">
                    <div class="method-card">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/7/71/PhonePe_Logo.svg" alt="PhonePe">
                    </div>
                </div>
            </div>

            <button type="submit" class="btn btn-success w-100 fw-bold py-3 rounded-4 shadow">Proceed to Pay</button>
          </form>
        </div>
      </div>
    </div>
</div>

<div class="modal fade" id="withdrawModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content shadow-lg">
        <div class="modal-body p-4">
          <div class="d-flex justify-content-between align-items-center mb-4">
              <h5 class="fw-bold mb-0">Withdraw</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>

          <form method="POST" action="{% url 'wallet_withdraw' %}">
            {% csrf_token %}
            <div class="mb-3">
              <label class="form-label fw-bold small text-muted">AMOUNT</label>
              <input type="number" name="amount" class="form-control rounded-4" min="50" placeholder="Min. â‚¹50" required>
            </div>
            <div class="mb-4">
              <label class="form-label fw-bold small text-muted">UPI ID / ACCOUNT</label>
              <input type="text" name="destination" class="form-control rounded-4" placeholder="user@upi" required>
            </div>
            <button type="submit" class="btn btn-primary w-100 fw-bold py-3 rounded-4 shadow">Confirm Transfer</button>
          </form>
        </div>
      </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Payment Method Selector logic
    document.querySelectorAll('.method-card').forEach(card => {
        card.addEventListener('click', function() {
            document.querySelectorAll('.method-card').forEach(c => {
                c.classList.remove('active');
                // Re-apply grayscale filter to non-active images
                c.querySelector('img').style.filter = 'grayscale(100%)';
                c.querySelector('img').style.opacity = '0.6';
            });
            this.classList.add('active');
            // Remove grayscale filter from active image
            this.querySelector('img').style.filter = 'none';
            this.querySelector('img').style.opacity = '1';
        });
    });
</script>

</body>
</html>