{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List Item | SamanLoop</title>

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        :root {
            --brand-teal: #20c997;
            --brand-teal-dark: #1ba87e;
            --navy-dark: #0a192f;
            --brand-yellow: #ffc107;
            --bg-gradient: radial-gradient(circle at top right, #f0fffb 0%, #f8fafc 100%);
            --text-main: #1e293b;
            --border-color: #e2e8f0;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            /* ðŸŽ¨ Better Background: Gradient instead of solid gray */
            background: var(--bg-gradient);
            background-attachment: fixed;
            color: var(--text-main);
        }

        /* ðŸ”¹ Glass Navbar */
        .navbar-custom {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            padding: 0.8rem 1.5rem;
        }

        /* ðŸ”¹ Premium Form Cards */
        .form-card {
            background: white;
            border-radius: 24px;
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 30px rgba(0,0,0,0.02);
            transition: all 0.3s ease;
        }

        .form-card:hover {
            box-shadow: 0 15px 40px rgba(32, 201, 151, 0.08);
            transform: translateY(-2px);
        }

        .section-title {
            font-size: 0.9rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--brand-teal-dark);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-title i {
            background: rgba(32, 201, 151, 0.1);
            padding: 8px;
            border-radius: 10px;
            font-size: 1.1rem;
        }

        /* ðŸ”¹ Styled Inputs */
        .form-control, .form-select {
            border-radius: 14px;
            padding: 12px 18px;
            border: 1px solid var(--border-color);
            background-color: #fff;
            transition: 0.2s;
        }

        .form-control:focus {
            border-color: var(--brand-teal);
            box-shadow: 0 0 0 4px rgba(32, 201, 151, 0.1);
            background-color: #fff;
        }

        /* ðŸ”¹ Visual Upload Area */
        .photo-upload-zone {
            border: 2px dashed var(--brand-teal);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
            background: #f0fffb;
            color: var(--brand-teal-dark);
        }

        .photo-upload-zone:hover {
            background: white;
            border-style: solid;
        }

        /* ðŸ”¹ Smart Tooltips & Banners */
        .pricing-hint {
            background: linear-gradient(135deg, var(--navy-dark) 0%, #1a365d 100%);
            color: white;
            border-radius: 20px;
            padding: 24px;
            position: relative;
            overflow: hidden;
        }

        .pricing-hint i {
            font-size: 2rem;
            opacity: 0.5;
            position: absolute;
            right: 20px;
            bottom: 10px;
        }

        .btn-publish {
            background: var(--brand-teal);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 18px;
            font-weight: 700;
            font-size: 1.1rem;
            transition: 0.3s;
            box-shadow: 0 10px 20px rgba(32, 201, 151, 0.2);
        }

        .btn-publish:hover {
            background: var(--brand-teal-dark);
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(32, 201, 151, 0.3);
            color: white;
        }
        
        #imagePreview img {
            width: 100%;
            height: 110px;
            object-fit: cover;
            border-radius: 12px;
            border: 2px solid white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .badge-suggested {
            background: var(--brand-yellow);
            color: var(--navy-dark);
            font-weight: 700;
            padding: 5px 12px;
            border-radius: 50px;
            font-size: 0.75rem;
        }
    </style>
</head>

<body>

<nav class="navbar navbar-custom sticky-top mb-4">
    <div class="container">
        <a class="btn btn-light btn-sm rounded-pill px-3 border shadow-sm" href="{% url 'index' %}">
            <i class="bi bi-arrow-left me-1"></i> Hub
        </a>
        <a class="navbar-brand fw-bold mx-auto" href="#">
            <img src="{% static 'images/Group 7.png' %}" alt="SamanLoop" height="40">
        </a>
        <div style="width: 70px;"></div> 
    </div>
</nav>

<div class="container py-4" style="max-width: 850px;">
    
    <div class="text-center mb-5">
        <h1 class="fw-bold h2">List Your Item</h1>
        <p class="text-muted">Fill in the details below to start earning.</p>
    </div>

    <form method="POST" enctype="multipart/form-data" id="listingForm">
        {% csrf_token %}

        <div class="form-card p-4 mb-4">
            <h6 class="section-title"><i class="bi bi-camera"></i> Photos & Media</h6>
            <div class="photo-upload-zone" onclick="document.getElementById('fileInput').click()">
                <i class="bi bi-images fs-1 d-block mb-2"></i>
                <h6 class="fw-bold">Upload Item Images</h6>
                <p class="small mb-0">Drag and drop or click to browse (Max 5)</p>
                <input type="file" id="fileInput" name="images" style="display: none;" multiple required accept="image/*">
            </div>
            <div class="row mt-3 g-3" id="imagePreview"></div>
        </div>

        <div class="form-card p-4 mb-4">
            <h6 class="section-title"><i class="bi bi-info-square"></i> General Details</h6>
            
            <div class="mb-4">
                <label class="form-label fw-bold small">Item Title</label>
                <input type="text" name="name" class="form-control" placeholder="e.g. Nikon Z6 Mirrorless Camera" required>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-md-6">
                    <label class="form-label fw-bold small">Category</label>
                    <select class="form-select" name="category" id="category" required>
                        <option value="" selected disabled>Select Category</option>
                        <option value="Electronics">Electronics</option>
                        <option value="Camping Gear">Camping Gear</option>
                        <option value="Tools">Tools</option>
                        <option value="Appliances">Appliances</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-bold small">Brand</label>
                    <input type="text" name="brand" id="brand" class="form-control" placeholder="e.g. Apple, Nikon, Bosch">
                </div>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-md-6">
                    <label class="form-label fw-bold small">Original Purchase Price (â‚¹)</label>
                    <input type="number" id="purchasePrice" name="purchase_price" class="form-control" placeholder="e.g. 80000" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-bold small">Purchase Year</label>
                    <input type="number" id="purchaseYear" name="purchase_year" class="form-control" placeholder="e.g. 2023" required>
                </div>
            </div>

            <div class="mb-4">
                <label class="form-label fw-bold small">Overall Quality</label>
                <select class="form-select" name="quality" id="quality" required>
                    <option value="Brand New">Brand New (Unopened)</option>
                    <option value="Like New">Like New (Barely Used)</option>
                    <option value="Gently Used" selected>Gently Used (Minor scratches)</option>
                </select>
            </div>
            
            <div>
                <label class="form-label fw-bold small">Item Description</label>
                <textarea class="form-control" name="description" rows="5" placeholder="Mention what's included (cables, bags, etc.) and any defects..."></textarea>
            </div>
        </div>

        <div class="form-card p-4 mb-4">
            <h6 class="section-title"><i class="bi bi-wallet2"></i> Pricing & Safety</h6>
            
            <div class="pricing-hint mb-4 shadow-sm">
                <div class="d-flex align-items-center gap-3">
                    <div class="bg-warning p-2 rounded-circle">
                        <i class="bi bi-lightning-charge-fill text-dark fs-5"></i>
                    </div>
                    <div>
                        <span class="fw-bold d-block">Dynamic Pricing Help</span>
                        <small class="opacity-75">We help you set a fair price based on market trends and item age.</small>
                    </div>
                </div>
                <i class="bi bi-currency-exchange"></i>
            </div>

            <div id="smartPriceBox" class="alert alert-success d-none mb-4 rounded-4 border-0 shadow-sm">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <i class="bi bi-check-circle-fill me-2"></i>
                        Smart Calculations Ready!
                    </div>
                    <span class="badge-suggested">AI SUGGESTION</span>
                </div>
                <hr class="my-2">
                <div class="row text-center mt-3">
                    <div class="col-6 border-end">
                        <small class="d-block text-muted">Daily Rent</small>
                        <h4 class="fw-bold mb-0">â‚¹<span id="suggestedPrice">0</span></h4>
                    </div>
                    <div class="col-6">
                        <small class="d-block text-muted">Security Deposit</small>
                        <h4 class="fw-bold mb-0">â‚¹<span id="suggestedDeposit">0</span></h4>
                    </div>
                </div>
            </div>

            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label fw-bold small">Your Rent Price (Per Day)</label>
                    <div class="input-group">
                        <span class="input-group-text border-end-0 rounded-start-4">â‚¹</span>
                        <input type="number" id="rent_per_day" name="rent_per_day" class="form-control rounded-end-4" min="50" max="10000" required>
                    </div>
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-bold small">Security Deposit (â‚¹)</label>
                    <div class="input-group">
                        <span class="input-group-text border-end-0 rounded-start-4">â‚¹</span>
                        <input type="number" id="deposit_amount" name="deposit_amount" class="form-control rounded-end-4" required>
                    </div>
                </div>
            </div>

            <div class="mt-4">
                <label class="form-label fw-bold small">Logistics Preference</label>
                <div class="row g-2">
                    <div class="col-6">
                        <input type="checkbox" class="btn-check" id="delivery" name="allow_delivery">
                        <label class="btn btn-outline-secondary w-100 py-3 rounded-4" for="delivery">
                            <i class="bi bi-truck me-2"></i> Doorstep
                        </label>
                    </div>
                    <div class="col-6">
                        <input type="checkbox" class="btn-check" id="pickup" name="self_pickup" checked>
                        <label class="btn btn-outline-secondary w-100 py-3 rounded-4" for="pickup">
                            <i class="bi bi-person-walking me-2"></i> Self-Pickup
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <div class="p-3 mb-4 rounded-4 bg-white border small shadow-sm">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="terms" required>
                <label class="form-check-label text-muted" for="terms">
                    I confirm that the item is clean, functional, and matches the description. I agree to SamanLoop's <a href="#" class="text-teal">Terms of Service</a>.
                </label>
            </div>
        </div>

        <button type="submit" class="btn btn-publish w-100 mb-5">
            Publish Your Listing <i class="bi bi-arrow-right-short ms-2"></i>
        </button>

    </form>
</div>



<script>
    // 1. SMART DEPOSIT CALCULATION
    function calculateDeposit(rent, purchasePrice) {
        let deposit = rent * 3; 
        let maxDeposit = purchasePrice * 0.45; // Capped at 45% of value
        return Math.min(deposit, maxDeposit);
    }

    // 2. SMART RENT CALCULATION ENGINE
    function calculateSmartPricing() {
        const price = parseFloat(document.getElementById("purchasePrice").value);
        const year = parseInt(document.getElementById("purchaseYear").value);
        const quality = document.getElementById("quality").value;
        const category = document.getElementById("category").value;

        if (!price || !year || !quality || !category) return;

        const age = Math.max(0, new Date().getFullYear() - year);
        let baseRent = price * 0.012; // Base 1.2% per day

        // Factors
        let ageFactor = age >= 4 ? 0.7 : (age >= 2 ? 0.85 : 1.0);
        const qualityFactor = {"Brand New": 1.0, "Like New": 0.95, "Gently Used": 0.8}[quality] || 0.7;
        const categoryFactor = {"Electronics": 1.1, "Tools": 1.0, "Camping Gear": 0.9, "Appliances": 0.85}[category] || 1.0;

        const finalRent = Math.round(baseRent * ageFactor * qualityFactor * categoryFactor);
        const finalDeposit = Math.round(calculateDeposit(finalRent, price));

        // UI Updates
        document.getElementById("smartPriceBox").classList.remove("d-none");
        document.getElementById("suggestedPrice").innerText = finalRent;
        document.getElementById("suggestedDeposit").innerText = finalDeposit;

        // Auto-fill
        const rentInput = document.getElementById("rent_per_day");
        const depositInput = document.getElementById("deposit_amount");
        if (!rentInput.value) rentInput.value = finalRent;
        if (!depositInput.value) depositInput.value = finalDeposit;
    }

    // 3. IMAGE PREVIEW
    document.getElementById("fileInput").addEventListener("change", function () {
        const preview = document.getElementById("imagePreview");
        preview.innerHTML = "";
        [...this.files].slice(0, 5).forEach(file => {
            const reader = new FileReader();
            reader.onload = e => {
                const col = document.createElement("div");
                col.className = "col-4 col-md-2 mb-2";
                col.innerHTML = `<img src="${e.target.result}" class="img-fluid rounded shadow-sm">`;
                preview.appendChild(col);
            };
            reader.readAsDataURL(file);
        });
    });

    // LISTENERS
    ["purchasePrice", "purchaseYear"].forEach(id => {
        document.getElementById(id).addEventListener("input", calculateSmartPricing);
    });
    ["quality", "category"].forEach(id => {
        document.getElementById(id).addEventListener("change", calculateSmartPricing);
    });
</script>

</body>
</html>